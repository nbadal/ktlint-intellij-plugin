<idea-plugin>
    <id>com.nbadal.ktlint</id>
    <name>Ktlint</name>
    <vendor url="https://nbad.al">Nick Badal</vendor>

    <depends>com.intellij.modules.platform</depends>
    <depends>org.jetbrains.kotlin</depends>
    <depends>org.editorconfig.editorconfigjetbrains</depends>

    <extensions defaultExtensionNs="com.intellij">
        <externalAnnotator language="kotlin" implementationClass="com.nbadal.ktlint.plugin.KtlintAnnotator" id="KtlintAnnotator"/>
        <postFormatProcessor implementation="com.nbadal.ktlint.plugin.KtlintPostFormatProcessor" />
        <projectConfigurable displayName="KtLint" groupId="tools" id="preferences.ktlint-plugin"
                             instance="com.nbadal.ktlint.plugin.KtlintConfig"/>
        <actionOnSaveInfoProvider implementation="com.nbadal.ktlint.plugin.KtlintActionOnSaveInfoProvider"
                                  order="after FormatOnSaveInfoProvider"/>
        <actionOnSave implementation="com.nbadal.ktlint.plugin.KtlintActionOnSave" order="after FormatOnSaveAction"/>

        <!-- Keep ids of the notificationGroups in sync with KtlintNotifier enum -->
        <notificationGroup id="Ktlint Configuration" displayType="STICKY_BALLOON"/>
        <notificationGroup id="Ktlint Rule" displayType="STICKY_BALLOON"/>
        <notificationGroup id="Ktlint Generic" displayType="BALLOON"/>
    </extensions>

    <!-- https://kotlin.github.io/analysis-api/declaring-k2-compatibility.html -->
    <extensions defaultExtensionNs="org.jetbrains.kotlin">
        <supportsKotlinPluginMode supportsK2="true" />
    </extensions>

    <extensions defaultExtensionNs="editorconfig">
        <optionDescriptorProvider implementation="com.nbadal.ktlint.plugin.KtlintEditorConfigOptionDescriptorProvider"/>
    </extensions>

    <actions>
        <action id="Ktlint.Lint" class="com.nbadal.ktlint.plugin.actions.LintAction"
                text="Show All Ktlint Violations In File" description="Show all Ktlint violations in the current file">
            <add-to-group group-id="RefactoringMenu" />
        </action>
        <action id="Ktlint.Format" class="com.nbadal.ktlint.plugin.actions.FormatAction"
                text="Format With Ktlint" description="Apply ktlint formatting to file">
            <add-to-group group-id="RefactoringMenu" />
        </action>
    </actions>

    <projectListeners>
        <listener class="com.nbadal.ktlint.plugin.KtlintFileEditorManagerListener" topic="com.intellij.openapi.fileEditor.FileEditorManagerListener" />
    </projectListeners>

    <applicationListeners>
        <listener class="com.nbadal.ktlint.plugin.KtlintBulkFileListener"
                  topic="com.intellij.openapi.vfs.newvfs.BulkFileListener"/>
    </applicationListeners>

    <change-notes>
        <![CDATA[
<h3>Noteworthy changes:</h3>
<ul>
    <li>Allow to configure the Ktlint version in file <strong>ktlint-plugin.properties</strong> for synchronization with other ktlint integrations in the same project.<a href="https://github.com/nbadal/ktlint-intellij-plugin/issues/711">More information</a></li>
    <li>Reconfigure Ktlint when switching projects or changing <strong>.editorconfig</strong></li>
</ul>
<h3>Requirements:</h3>
<ul>
    <li>Intellij IDEA Platform 2024.1 - 2025.3</li>
</ul>
        ]]>
    </change-notes>
</idea-plugin>
